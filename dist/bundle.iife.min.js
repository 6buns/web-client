var Bun=function(e){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return u(this,n)}}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=l(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},h.apply(this,arguments)}function d(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
var y=function(e,t){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},y(e,t)};function m(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function g(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function b(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function k(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}var w=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,C=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],E=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o,i,s=w.exec(e||""),a={},c=14;c--;)a[C[c]]=s[c]||"";return-1!=n&&-1!=r&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){var n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.substr(0,1)&&0!==t.length||r.splice(0,1);"/"==t.substr(t.length-1,1)&&r.splice(r.length-1,1);return r}(0,a.path),a.queryKey=(o=a.query,i={},o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(i[t]=n)})),i),a};var S={exports:{}};try{S.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){S.exports=!1}var _=S.exports,A="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function T(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||_))return new XMLHttpRequest}catch(e){}if(!t)try{return new(A[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function O(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var R=setTimeout,x=clearTimeout;function F(e,t){t.useNativeTimers?(e.setTimeoutFn=R.bind(A),e.clearTimeoutFn=x.bind(A)):(e.setTimeoutFn=setTimeout.bind(A),e.clearTimeoutFn=clearTimeout.bind(A))}var L=N;function N(e){if(e)return function(e){for(var t in N.prototype)e[t]=N.prototype[t];return e}(e)}N.prototype.on=N.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},N.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},N.prototype.off=N.prototype.removeListener=N.prototype.removeAllListeners=N.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},N.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t)}return this},N.prototype.emitReserved=N.prototype.emit,N.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},N.prototype.hasListeners=function(e){return!!this.listeners(e).length};var P=Object.create(null);P.open="0",P.close="1",P.ping="2",P.pong="3",P.message="4",P.upgrade="5",P.noop="6";var j=Object.create(null);Object.keys(P).forEach((function(e){j[P[e]]=e}));for(var B={type:"error",data:"parser error"},M="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),D="function"==typeof ArrayBuffer,I=function(e,t,n){var r,o=e.type,i=e.data;return M&&i instanceof Blob?t?n(i):q(i,n):D&&(i instanceof ArrayBuffer||(r=i,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer))?t?n(i):q(new Blob([i]),n):n(P[o]+(i||""))},q=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",V="undefined"==typeof Uint8Array?[]:new Uint8Array(256),z=0;z<U.length;z++)V[U.charCodeAt(z)]=z;var H,K="function"==typeof ArrayBuffer,J=function(e,t){if("string"!=typeof e)return{type:"message",data:$(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:Y(e.substring(1),t)}:j[n]?e.length>1?{type:j[n],data:e.substring(1)}:{type:j[n]}:B},Y=function(e,t){if(K){var n=function(e){var t,n,r,o,i,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),f=new Uint8Array(u);for(t=0;t<a;t+=4)n=V[e.charCodeAt(t)],r=V[e.charCodeAt(t+1)],o=V[e.charCodeAt(t+2)],i=V[e.charCodeAt(t+3)],f[c++]=n<<2|r>>4,f[c++]=(15&r)<<4|o>>2,f[c++]=(3&o)<<6|63&i;return u}(e);return $(n,t)}return{base64:!0,data:e}},$=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},W=String.fromCharCode(30),X=function(e){i(r,e);var t=f(r);function r(e){var o;return n(this,r),(o=t.call(this)).writable=!1,F(c(o),e),o.opts=e,o.query=e.query,o.readyState="",o.socket=e.socket,o}return o(r,[{key:"onError",value:function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,h(s(r.prototype),"emit",this).call(this,"error",n),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,h(s(r.prototype),"emit",this).call(this,"open")}},{key:"onData",value:function(e){var t=J(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){h(s(r.prototype),"emit",this).call(this,"packet",e)}},{key:"onClose",value:function(){this.readyState="closed",h(s(r.prototype),"emit",this).call(this,"close")}}]),r}(L),G="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Z={},Q=0,ee=0;function te(e){var t="";do{t=G[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function ne(){var e=te(+new Date);return e!==H?(Q=0,H=e):e+"."+te(Q++)}for(;ee<64;ee++)Z[G[ee]]=ee;ne.encode=te,ne.decode=function(e){var t=0;for(ee=0;ee<e.length;ee++)t=64*t+Z[e.charAt(ee)];return t};var re=ne,oe={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},ie=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).polling=!1,e}return o(r,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var r=0;this.polling&&(r++,this.once("pollComplete",(function(){--r||n()}))),this.writable||(r++,this.once("drain",(function(){--r||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(W),r=[],o=0;o<n.length;o++){var i=J(n[o],t);if(r.push(i),"error"===i.type)break}return r})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,r=new Array(n),o=0;e.forEach((function(e,i){I(e,!1,(function(e){r[i]=e,++o===n&&t(r.join(W))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emit("drain")}))}))}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=re()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);var r=oe.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}}]),r}(X);function se(){}var ae=null!=new T({xdomain:!1}).responseType,ce=function(e){i(r,e);var t=f(r);function r(e){var o;if(n(this,r),o=t.call(this,e),"undefined"!=typeof location){var i="https:"===location.protocol,s=location.port;s||(s=i?"443":"80"),o.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,o.xs=e.secure!==i}var a=e&&e.forceBase64;return o.supportsBinary=ae&&!a,o}return o(r,[{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new ue(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(function(e){n.onError("xhr post error",e)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t}}]),r}(ie),ue=function(e){i(r,e);var t=f(r);function r(e,o){var i;return n(this,r),F(c(i=t.call(this)),o),i.opts=o,i.method=o.method||"GET",i.uri=e,i.async=!1!==o.async,i.data=void 0!==o.data?o.data:null,i.create(),i}return o(r,[{key:"create",value:function(){var e=this,t=O(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;var n=this.xhr=new T(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var o in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.opts.extraHeaders[o])}catch(e){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?e.onLoad():e.setTimeoutFn((function(){e.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(t){return void this.setTimeoutFn((function(){e.onError(t)}),0)}"undefined"!=typeof document&&(this.index=r.requestsCount++,r.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=se,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete r.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"abort",value:function(){this.cleanup()}}]),r}(L);if(ue.requestsCount=0,ue.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",fe);else if("function"==typeof addEventListener){addEventListener("onpagehide"in A?"pagehide":"unload",fe,!1)}function fe(){for(var e in ue.requests)ue.requests.hasOwnProperty(e)&&ue.requests[e].abort()}var le="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},he=A.WebSocket||A.MozWebSocket,de="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),pe=function(e){i(r,e);var t=f(r);function r(e){var o;return n(this,r),(o=t.call(this,e)).supportsBinary=!e.forceBase64,o}return o(r,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=de?{}:O(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=de?new he(e,t,n):t?new he(e,t):new he(e)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(n){var r=e[n],o=n===e.length-1;I(r,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(e){}o&&le((function(){t.writable=!0,t.emit("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n(r)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=re()),this.supportsBinary||(e.b64=1);var r=oe.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}},{key:"check",value:function(){return!(!he||"__initialize"in he&&this.name===r.prototype.name)}}]),r}(X),ve={websocket:pe,polling:ce},ye=function(e){i(s,e);var r=f(s);function s(e){var o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n(this,s),o=r.call(this),e&&"object"===t(e)&&(i=e,e=null),e?(e=E(e),i.hostname=e.host,i.secure="https"===e.protocol||"wss"===e.protocol,i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=E(i.host).host),F(c(o),i),o.secure=null!=i.secure?i.secure:"undefined"!=typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=o.secure?"443":"80"),o.hostname=i.hostname||("undefined"!=typeof location?location.hostname:"localhost"),o.port=i.port||("undefined"!=typeof location&&location.port?location.port:o.secure?"443":"80"),o.transports=i.transports||["polling","websocket"],o.readyState="",o.writeBuffer=[],o.prevBufferLen=0,o.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),o.opts.path=o.opts.path.replace(/\/$/,"")+"/","string"==typeof o.opts.query&&(o.opts.query=oe.decode(o.opts.query)),o.id=null,o.upgrades=null,o.pingInterval=null,o.pingTimeout=null,o.pingTimeoutTimer=null,"function"==typeof addEventListener&&(o.opts.closeOnBeforeunload&&addEventListener("beforeunload",(function(){o.transport&&(o.transport.removeAllListeners(),o.transport.close())}),!1),"localhost"!==o.hostname&&(o.offlineEventListener=function(){o.onClose("transport close")},addEventListener("offline",o.offlineEventListener,!1))),o.open(),o}return o(s,[{key:"createTransport",value:function(e){var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new ve[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&s.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(){t.onClose("transport close")}))}},{key:"probe",value:function(e){var t=this,n=this.createTransport(e),r=!1;s.priorWebsocketSuccess=!1;var o=function(){r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(function(e){if(!r)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",n),!n)return;s.priorWebsocketSuccess="websocket"===n.name,t.transport.pause((function(){r||"closed"!==t.readyState&&(l(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=n.name,t.emitReserved("upgradeError",o)}})))};function i(){r||(r=!0,l(),n.close(),n=null)}var a=function(e){var r=new Error("probe error: "+e);r.transport=n.name,i(),t.emitReserved("upgradeError",r)};function c(){a("transport closed")}function u(){a("socket closed")}function f(e){n&&e.name!==n.name&&i()}var l=function(){n.removeListener("open",o),n.removeListener("error",a),n.removeListener("close",c),t.off("close",u),t.off("upgrading",f)};n.once("open",o),n.once("error",a),n.once("close",c),this.once("close",u),this.once("upgrading",f),n.open()}},{key:"onOpen",value:function(){if(this.readyState="open",s.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},r=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?r():t()})):this.upgrading?r():t()),this}},{key:"onError",value:function(e){s.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),s}(L);ye.protocol=4;var me="function"==typeof ArrayBuffer,ge=Object.prototype.toString,be="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ge.call(Blob),ke="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ge.call(File);function we(e){return me&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))||be&&e instanceof Blob||ke&&e instanceof File}function Ce(e,n){if(!e||"object"!==t(e))return!1;if(Array.isArray(e)){for(var r=0,o=e.length;r<o;r++)if(Ce(e[r]))return!0;return!1}if(we(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Ce(e.toJSON(),!0);for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&Ce(e[i]))return!0;return!1}function Ee(e){var t=[],n=e.data,r=e;return r.data=Se(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Se(e,n){if(!e)return e;if(we(e)){var r={_placeholder:!0,num:n.length};return n.push(e),r}if(Array.isArray(e)){for(var o=new Array(e.length),i=0;i<e.length;i++)o[i]=Se(e[i],n);return o}if("object"===t(e)&&!(e instanceof Date)){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(s[a]=Se(e[a],n));return s}return e}function _e(e,t){return e.data=Ae(e.data,t),e.attachments=void 0,e}function Ae(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]=Ae(e[r],n);else if("object"===t(e))for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(e[o]=Ae(e[o],n));return e}var Te;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Te||(Te={}));var Oe=function(){function e(){n(this,e)}return o(e,[{key:"encode",value:function(e){return e.type!==Te.EVENT&&e.type!==Te.ACK||!Ce(e)?[this.encodeAsString(e)]:(e.type=e.type===Te.EVENT?Te.BINARY_EVENT:Te.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==Te.BINARY_EVENT&&e.type!==Te.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),t}},{key:"encodeAsBinary",value:function(e){var t=Ee(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}]),e}(),Re=function(e){i(a,e);var r=f(a);function a(){return n(this,a),r.call(this)}return o(a,[{key:"add",value:function(e){var t;if("string"==typeof e)(t=this.decodeString(e)).type===Te.BINARY_EVENT||t.type===Te.BINARY_ACK?(this.reconstructor=new xe(t),0===t.attachments&&h(s(a.prototype),"emitReserved",this).call(this,"decoded",t)):h(s(a.prototype),"emitReserved",this).call(this,"decoded",t);else{if(!we(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,h(s(a.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===Te[n.type])throw new Error("unknown packet type "+n.type);if(n.type===Te.BINARY_EVENT||n.type===Te.BINARY_ACK){for(var r=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(r,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var i=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(i,t)}else n.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var c=t+1;++t;){var u=e.charAt(t);if(null==u||Number(u)!=u){--t;break}if(t===e.length)break}n.id=Number(e.substring(c,t+1))}if(e.charAt(++t)){var f=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!a.isPayloadValid(n.type,f))throw new Error("invalid payload");n.data=f}return n}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(e,n){switch(e){case Te.CONNECT:return"object"===t(n);case Te.DISCONNECT:return void 0===n;case Te.CONNECT_ERROR:return"string"==typeof n||"object"===t(n);case Te.EVENT:case Te.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case Te.ACK:case Te.BINARY_ACK:return Array.isArray(n)}}}]),a}(L);var xe=function(){function e(t){n(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return o(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=_e(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),Fe=Object.freeze({__proto__:null,protocol:5,get PacketType(){return Te},Encoder:Oe,Decoder:Re});function Le(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var Ne=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Pe=function(e){i(r,e);var t=f(r);function r(e,o,i){var s;return n(this,r),(s=t.call(this)).connected=!1,s.disconnected=!0,s.receiveBuffer=[],s.sendBuffer=[],s.ids=0,s.acks={},s.flags={},s.io=e,s.nsp=o,i&&i.auth&&(s.auth=i.auth),s.io._autoConnect&&s.open(),s}return o(r,[{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[Le(e,"open",this.onopen.bind(this)),Le(e,"packet",this.onpacket.bind(this)),Le(e,"error",this.onerror.bind(this)),Le(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Ne.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.unshift(e);var o={type:Te.EVENT,data:n,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var i=this.ids++,s=n.pop();this._registerAckCallback(i,s),o.id=i}var a=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,c=this.flags.volatile&&(!a||!this.connected);return c||(this.connected?this.packet(o):this.sendBuffer.push(o)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n=this,r=this.flags.timeout;if(void 0!==r){var o=this.io.setTimeoutFn((function(){delete n.acks[e];for(var r=0;r<n.sendBuffer.length;r++)n.sendBuffer[r].id===e&&n.sendBuffer.splice(r,1);t.call(n,new Error("operation has timed out"))}),r);this.acks[e]=function(){n.io.clearTimeoutFn(o);for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];t.apply(n,[null].concat(r))}}else this.acks[e]=t}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e.packet({type:Te.CONNECT,data:t})})):this.packet({type:Te.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case Te.CONNECT:if(e.data&&e.data.sid){var t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Te.EVENT:case Te.BINARY_EVENT:this.onevent(e);break;case Te.ACK:case Te.BINARY_ACK:this.onack(e);break;case Te.DISCONNECT:this.ondisconnect();break;case Te.CONNECT_ERROR:this.destroy();var n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}(this._anyListeners.slice());try{for(n.s();!(t=n.n()).done;){t.value.apply(this,e)}}catch(e){n.e(e)}finally{n.f()}}h(s(r.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];t.packet({type:Te.ACK,id:e,data:o})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){return e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:Te.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),r}(L),je=Be;function Be(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Be.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Be.prototype.reset=function(){this.attempts=0},Be.prototype.setMin=function(e){this.ms=e},Be.prototype.setMax=function(e){this.max=e},Be.prototype.setJitter=function(e){this.jitter=e};var Me=function(e){i(s,e);var r=f(s);function s(e,o){var i,a;n(this,s),(i=r.call(this)).nsps={},i.subs=[],e&&"object"===t(e)&&(o=e,e=void 0),(o=o||{}).path=o.path||"/socket.io",i.opts=o,F(c(i),o),i.reconnection(!1!==o.reconnection),i.reconnectionAttempts(o.reconnectionAttempts||1/0),i.reconnectionDelay(o.reconnectionDelay||1e3),i.reconnectionDelayMax(o.reconnectionDelayMax||5e3),i.randomizationFactor(null!==(a=o.randomizationFactor)&&void 0!==a?a:.5),i.backoff=new je({min:i.reconnectionDelay(),max:i.reconnectionDelayMax(),jitter:i.randomizationFactor()}),i.timeout(null==o.timeout?2e4:o.timeout),i._readyState="closed",i.uri=e;var u=o.parser||Fe;return i.encoder=new u.Encoder,i.decoder=new u.Decoder,i._autoConnect=!1!==o.autoConnect,i._autoConnect&&i.open(),i}return o(s,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new ye(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var o=Le(n,"open",(function(){r.onopen(),e&&e()})),i=Le(n,"error",(function(n){r.cleanup(),r._readyState="closed",t.emitReserved("error",n),e?e(n):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var s=this._timeout;0===s&&o();var a=this.setTimeoutFn((function(){o(),n.close(),n.emit("error",new Error("timeout"))}),s);this.opts.autoUnref&&a.unref(),this.subs.push((function(){clearTimeout(a)}))}return this.subs.push(o),this.subs.push(i),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(Le(e,"ping",this.onping.bind(this)),Le(e,"data",this.ondata.bind(this)),Le(e,"error",this.onerror.bind(this)),Le(e,"close",this.onclose.bind(this)),Le(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){this.emitReserved("packet",e)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new Pe(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var r=n[t];if(this.nsps[r].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var r=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),s}(L),De={};function Ie(e,n){"object"===t(e)&&(n=e,e=void 0);var r,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=E(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+t,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}(e,(n=n||{}).path||"/socket.io"),i=o.source,s=o.id,a=o.path,c=De[s]&&a in De[s].nsps;return n.forceNew||n["force new connection"]||!1===n.multiplex||c?r=new Me(i,n):(De[s]||(De[s]=new Me(i,n)),r=De[s]),o.query&&!n.query&&(n.query=o.queryKey),r.socket(o.path,n)}Object.assign(Ie,{Manager:Me,Socket:Pe,io:Ie,connect:Ie});var qe={exports:{}},Ue=1e3,Ve=6e4,ze=60*Ve,He=24*ze,Ke=7*He,Je=365.25*He,Ye=function(e,n){n=n||{};var r=t(e);if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*Je;case"weeks":case"week":case"w":return n*Ke;case"days":case"day":case"d":return n*He;case"hours":case"hour":case"hrs":case"hr":case"h":return n*ze;case"minutes":case"minute":case"mins":case"min":case"m":return n*Ve;case"seconds":case"second":case"secs":case"sec":case"s":return n*Ue;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===r&&isFinite(e))return n.long?function(e){var t=Math.abs(e);if(t>=He)return $e(e,t,He,"day");if(t>=ze)return $e(e,t,ze,"hour");if(t>=Ve)return $e(e,t,Ve,"minute");if(t>=Ue)return $e(e,t,Ue,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=He)return Math.round(e/He)+"d";if(t>=ze)return Math.round(e/ze)+"h";if(t>=Ve)return Math.round(e/Ve)+"m";if(t>=Ue)return Math.round(e/Ue)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function $e(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}var We=function(e){function t(e){var r,o,i,s=null;function a(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(a.enabled){var i=a,s=Number(new Date),c=s-(r||s);i.diff=c,i.prev=r,i.curr=s,r=s,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var u=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";u++;var o=t.formatters[r];if("function"==typeof o){var s=n[u];e=o.call(i,s),n.splice(u,1),u--}return e})),t.formatArgs.call(i,n);var f=i.log||t.log;f.apply(i,n)}}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i)},set:function(e){s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(d(t.names.map(r)),d(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Ye,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){var n;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))})),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,function(){n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=We(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(qe,qe.exports);var Xe,Ge=qe.exports,Ze={exports:{}},Qe="object"===("undefined"==typeof Reflect?"undefined":t(Reflect))?Reflect:null,et=Qe&&"function"==typeof Qe.apply?Qe.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};Xe=Qe&&"function"==typeof Qe.ownKeys?Qe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var tt=Number.isNaN||function(e){return e!=e};function nt(){nt.init.call(this)}Ze.exports=nt,Ze.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}ht(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&ht(e,"error",t,n)}(e,o,{once:!0})}))},nt.EventEmitter=nt,nt.prototype._events=void 0,nt.prototype._eventsCount=0,nt.prototype._maxListeners=void 0;var rt=10;function ot(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+t(e))}function it(e){return void 0===e._maxListeners?nt.defaultMaxListeners:e._maxListeners}function st(e,t,n,r){var o,i,s,a;if(ot(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=it(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function at(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ct(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=at.bind(r);return o.listener=n,r.wrapFn=o,o}function ut(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):lt(o,o.length)}function ft(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function lt(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function ht(e,n,r,o){if("function"==typeof e.on)o.once?e.once(n,r):e.on(n,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+t(e));e.addEventListener(n,(function t(i){o.once&&e.removeEventListener(n,t),r(i)}))}}Object.defineProperty(nt,"defaultMaxListeners",{enumerable:!0,get:function(){return rt},set:function(e){if("number"!=typeof e||e<0||tt(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");rt=e}}),nt.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},nt.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||tt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},nt.prototype.getMaxListeners=function(){return it(this)},nt.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var s=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw s.context=i,s}var a=o[e];if(void 0===a)return!1;if("function"==typeof a)et(a,this,t);else{var c=a.length,u=lt(a,c);for(n=0;n<c;++n)et(u[n],this,t)}return!0},nt.prototype.addListener=function(e,t){return st(this,e,t,!1)},nt.prototype.on=nt.prototype.addListener,nt.prototype.prependListener=function(e,t){return st(this,e,t,!0)},nt.prototype.once=function(e,t){return ot(t),this.on(e,ct(this,e,t)),this},nt.prototype.prependOnceListener=function(e,t){return ot(t),this.prependListener(e,ct(this,e,t)),this},nt.prototype.removeListener=function(e,t){var n,r,o,i,s;if(ot(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},nt.prototype.off=nt.prototype.removeListener,nt.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},nt.prototype.listeners=function(e){return ut(this,e,!0)},nt.prototype.rawListeners=function(e){return ut(this,e,!1)},nt.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):ft.call(e,t)},nt.prototype.listenerCount=ft,nt.prototype.eventNames=function(){return this._eventsCount>0?Xe(this._events):[]};var dt=Ge("Socket"),pt=Ge("Peer"),vt=Ge("Remote"),yt=function(e){function t(t){var n=t.secret,r=t.room,o=t.hasVideo,i=t.hasAudio,s=e.call(this)||this;return s.handleMessage=function(e){var t=e.type,n=e.from,r=e.to,o=e.room,i=e.token;return m(s,void 0,void 0,(function(){var e,s;return g(this,(function(a){try{if(e=this.decrypt(i))switch(t){case"peer-connection-request":this.onPeerConnectRequest({from:n,to:r,data:e});break;case"data":this.handlePeerData({from:n,to:r,data:e});break;case"track-update":this.handleTrackUpdate(e);break;case"socket-update":this.handleSocketUpdate(e);break;case"error":s=e.error,dt("Socket Server Error",s),this.emit("error",s);break;default:dt("Unknown Event Type",{type:t,from:n,to:r,room:o,data:e})}}catch(e){dt("Token Decoding Error",e)}return[2]}))}))},s.onPeerConnectRequest=function(e){var t=e.from,n=e.to,r=e.data,o=r.response,i=r.peerName;o&&s.sendMessage("connection-request",{from:n,to:t,data:{response:!1,peerName:s.name}}),dt("New Peer Connected. Waiting for an offer"),s.peers.set(i,new RTCPeerConnection({iceServers:s.iceServers}));var a=s.peers.get(i);vt("Adding Tracks",s.streams),s.streams.getTracks().forEach((function(e){a.addTrack(e,s.streams)})),vt("Tracks Added"),a.ontrack=function(e){var t=e.currentTarget.to;s.remoteStreams.set(t.name,e.streams),s.emit("new-remote-track",e)},a.onicecandidate=function(e){if(e.candidate){vt("ICE Candidate",e);var t=e.currentTarget;s.sendMessage("data",{from:t.from.socket,to:t.to.socket,data:{name:a.from.name,candidate:e.candidate}})}},a.onnegotiationneeded=function(e){return m(s,void 0,void 0,(function(){var t,n,r;return g(this,(function(o){switch(o.label){case 0:t=e.currentTarget,o.label=1;case 1:return o.trys.push([1,4,5,6]),t.makingOffer=!0,vt("Negotiation needed",e),[4,t.createOffer()];case 2:return n=o.sent(),vt("Offer Generated",n),"stable"!=t.signalingState?[2]:[4,t.setLocalDescription(n)];case 3:return o.sent(),vt("Local Description Set",t.localDescription),this.sendMessage("data",{to:t.to.socket,from:t.from.socket,data:{name:t.from.name,sdp:t.localDescription}}),[3,6];case 4:return r=o.sent(),console.error(new Error(r)),[3,6];case 5:return t.makingOffer=!1,[7];case 6:return[2]}}))}))},a.ondatachannel=function(e){s.recieveDataChannels.set(i,e.channel),e.channel.onmessage=function(e){s.emit("peer-data-recieved",e.data),pt("Recieve Data Channel Message Recieved : ",e.data)},e.channel.onopen=function(e){s.emit("peer-data-open",e),pt("Recieve Data Channel Open : ",e)},e.channel.onclose=function(e){s.emit("peer-data-closed",e),pt("Recieve Data Channel Closed : ",e)}};var c=a.createDataChannel("sendChannel");c.onopen=function(e){pt("Send Data Channel Open : ",e)},c.onclose=function(e){pt("Send Data Channel Closed : ",e)},s.sendDataChannels.set(i,c),a.onconnectionstatechange=function(e){switch(a.connectionState){case"new":case"connecting":vt("Connecting...");break;case"connected":vt("Connected."),s.emit("new-peer",a),a.checkConnection();break;case"disconnected":vt("Disconnecting..."),a.checkConnection();break;case"closed":vt("Offline");break;case"failed":vt("Error"),a.checkConnection()}},a.checkConnection=function(){var e=a.connectionState,t=a.iceConnectionState,n=a.iceGatheringState,r=a.signalingState;"connected"===e&&"connected"===t&&"complete"===n&&"stable"===r?vt("Connection Established."):"disconnected"!==e&&"closed"!==e&&"failed"!==e||"disconnected"!==t&&"failed"!==t&&"closed"!==t||(vt("Error in Connection Establishment"),s.emit("peer-left",a.to.name),s.removePeer(a.to.name))},a.from={name:s.name,socket:s.socket.id},a.to={name:i,socket:t},a.initiator=o,a.ignoreOffer=!1,a.makingOffer=!1,a.socket=s.socket,a.poster=s.createPoster(i)},s.handlePeerData=function(e){var t=e.to,n=e.from,r=e.data;return m(s,void 0,void 0,(function(){var e,o,i,s,a,c,u,f;return g(this,(function(l){switch(l.label){case 0:if(e=r.name,o=r.sdp,i=r.candidate,!this.peers.has(e)||t!==this.socket.id)return[3,15];l.label=1;case 1:return l.trys.push([1,14,,15]),s=this.peers.get(e),pt("Data recieved",{name:e,sdp:o,candidate:i}),o?(a="offer"===o.type&&(s.makingOffer||"stable"!==s.signalingState),s.ignoreOffer=!s.initiator&&a,s.ignoreOffer?[2]:a?[4,Promise.all([s.setLocalDescription({type:"rollback"}),s.setRemoteDescription(o)])]:[3,3]):[3,9];case 2:return l.sent(),[3,5];case 3:return pt("Answer Recieved",o),[4,s.setRemoteDescription(o)];case 4:l.sent(),l.label=5;case 5:return"offer"!==o.type?[3,8]:[4,s.createAnswer()];case 6:return c=l.sent(),pt("Answer Created",c),[4,s.setLocalDescription(c)];case 7:l.sent(),pt("Local description set as answer",s.localDescription),this.sendMessage("data",{to:n,from:t,data:{name:this.name,sdp:s.localDescription}}),l.label=8;case 8:return[3,13];case 9:if(!i)return[3,13];l.label=10;case 10:return l.trys.push([10,12,,13]),[4,s.addIceCandidate(i)];case 11:return l.sent(),pt("Added Ice Candidate",i),[3,13];case 12:return u=l.sent(),s.ignoreOffer?pt("Should be ignored",u,i,this.peers.has(e),t===this.socket.id):pt("Error adding IceCandidate",u),[3,13];case 13:return[3,15];case 14:return f=l.sent(),dt("Socket Error",f),[3,15];case 15:return[2]}}))}))},s.handleTrackUpdate=function(e){var t=e.id,n=e.update;switch(dt("Track Update Recieved",t,n),n){case"mute":s.emit("remote-peer-track-muted",t);break;case"unmute":s.emit("remote-peer-track-unmuted",t);break;case"end":s.remoteStreams.get(t).forEach((function(e){return e.getVideoTracks()[0].stop()})),s.emit("remote-peer-track-ended",t)}},s.handleSocketUpdate=function(e){var t=e.id,n=e.name;s.peers.get(n).to.socket=t,dt("Socket ID updated for peer.")},s.getStats=function(){return new Promise((function(e,t){return m(s,void 0,void 0,(function(){var t,n,r,o,i,s,a,c,u,f,l;return g(this,(function(h){switch(h.label){case 0:t={},h.label=1;case 1:h.trys.push([1,6,7,8]),n=b(this.peers),r=n.next(),h.label=2;case 2:return r.done?[3,5]:(o=k(r.value,2),i=o[0],s=o[1],a=t,c=i,[4,s.getStats(null)]);case 3:a[c]=h.sent(),h.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),f={error:u},[3,8];case 7:try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(f)throw f.error}return[7];case 8:return e(t),[2]}}))}))}))},s.sendMessage=function(e,t,n){var r=t.from,o=t.to,i=t.room,a=t.data;return m(s,void 0,void 0,(function(){var t;return g(this,(function(s){return t=this.crypt(a),this.socket.emit("message",{type:e,from:r,to:o,room:i,token:t},n),[2]}))}))},s.join=function(){return m(s,void 0,void 0,(function(){var e=this;return g(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){dt("Joining Room"),e.sendMessage("room-join",{room:e.room,data:{name:e.name}},(function(n){var r=n.res,o=n.error;o?(e.emit("error",o),dt("Room Join Error",o)):r&&(dt("Room Joined",r),r.length>1&&(dt("Peers List Recieved"),r.forEach((function(t){t!==e.socket.id&&e.sendMessage("connection-request",{from:e.socket.id,to:t,data:{response:!0,peerName:e.name}})})),pt("Establishing Peer Connection to Remote Peer."),t()))}))}))];case 1:return t.sent(),[2]}}))}))},s.startMedia=function(e){return m(s,void 0,void 0,(function(){var t;return g(this,(function(n){switch(n.label){case 0:return[4,this.getMedia()];case 1:return t=n.sent(),this.addStream(t),e?this.streams=t:(this.streams=t,this.replaceMedia(t)),[2]}}))}))},s.getMedia=function(){return new Promise((function(e,t){navigator.mediaDevices.getUserMedia({video:s.media.video,audio:s.media.audio}).then((function(t){pt(t),e(t)})).catch(t)}))},s.screenShare=function(){return navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){var t=e.getVideoTracks()[0];pt("Sharing Screen",t),t.onended=function(e){return m(s,void 0,void 0,(function(){return g(this,(function(t){return pt("Stop Sharing Screen"),this.emit("screen-share-ended",e),this.replaceMedia(this.streams),this.addStream(this.streams),[2]}))}))},s.replaceMedia(e),s.addStream(e)})).catch(console.error)},s.addStream=function(e){var t=document.querySelector(".self");t.srcObject=e,t.onloadedmetadata=function(e){t.play()}},s.toggleMedia=function(e,t){if(e)switch(e){case"video":s.streams.getVideoTracks().forEach((function(e){e.enabled=!e.enabled}));break;case"audio":s.streams.getAudioTracks().forEach((function(e){e.enabled=!e.enabled}));break;case"all":s.streams.getTracks().forEach((function(e){e.enabled=!e.enabled}))}t&&s.peers.get(t).getSenders().forEach((function(t){var n,r;e?(null===(n=null==t?void 0:t.track)||void 0===n?void 0:n.kind)===e&&t.track.stop():null===(r=null==t?void 0:t.track)||void 0===r||r.stop()}))},s.createPoster=function(e){var t=document.createElement("canvas");t.id="canv",t.height=600,t.width=800,document.body.appendChild(t);var n=document.getElementById("canv").getContext("2d");n.fillStyle="#1C1917",n.fillRect(0,0,800,600),n.fillStyle="#FAFAF9",n.textAlign="center",n.font="64px sans-serif",n.fillText(e,400,300);var r=t.toDataURL();return document.body.removeChild(t),r},s.getLocalMedia=function(e){return s.peers.get(e).getLocalStream()},s.getRemoteStream=function(e){return s.peers.get(e).getRemoteStream()},s.replaceMediaTrack=function(e,t){var n,r;if(t)s.peers.get(t).getSenders().forEach((function(t){var n;(null===(n=null==t?void 0:t.track)||void 0===n?void 0:n.kind)===e.kind&&(e.enabled=!0,t.replaceTrack(e))}));else try{for(var o=b(s.peers),i=o.next();!i.done;i=o.next()){var a=k(i.value,2);a[0];a[1].getSenders().forEach((function(t){var n;(null===(n=null==t?void 0:t.track)||void 0===n?void 0:n.kind)===e.kind&&t.replaceTrack(e)}))}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},s.replaceMedia=function(e,t){return new Promise((function(n,r){var o,i,a,c,u,f;try{if(t)try{for(var l=b(e.getTracks()),h=l.next();!h.done;h=l.next()){var d=h.value;t?s.replaceMediaTrack(d,t):s.replaceMediaTrack(d),pt("Replacing Track",d,t)}}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}else try{for(var p=b(s.peers),v=p.next();!v.done;v=p.next()){var y=k(v.value,2),m=y[0];if(y[1].getSenders().length>0)try{for(var g=(u=void 0,b(e.getTracks())),w=g.next();!w.done;w=g.next()){d=w.value;s.replaceMediaTrack(d,m),pt("Replacing Track",d,m)}}catch(e){u={error:e}}finally{try{w&&!w.done&&(f=g.return)&&f.call(g)}finally{if(u)throw u.error}}}}catch(e){a={error:e}}finally{try{v&&!v.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}n(!0)}catch(e){r(e)}}))},s.addMediaTrack=function(e,t){var n,r;if(s.streams.addTrack(e),t)s.peers.get(t).addTrack(e);else if(s.peers.size>0)try{for(var o=b(s.peers),i=o.next();!i.done;i=o.next()){var a=k(i.value,2);a[0];a[1].addTrack(e)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},s.addMedia=function(e,t){e.getTracks().forEach((function(e){return t?s.addMediaTrack(e,t):s.addMediaTrack(e)})),pt("Added new Stream",s.peers)},s.removeMediaTrack=function(e){var t,n,r=function(t,n){n.getSenders().forEach((function(t){var r;(null===(r=null==t?void 0:t.track)||void 0===r?void 0:r.kind)===e.kind&&(n.removeTrack(t),dt("Track Update Request Sent."),s.sendMessage("track-update",{room:s.room,data:{id:n.from.name,update:"end"}}))}))};try{for(var o=b(s.peers),i=o.next();!i.done;i=o.next()){var a=k(i.value,2);a[0];r(0,a[1])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}s.streams.removeTrack(e)},s.removeMedia=function(e){e.getTracks().forEach((function(e){return s.removeMediaTrack(e)})),pt("Removed Stream",e)},s.sendData=function(e,t,n){var r,o;if(t)s.sendDataChannels.get(t).send(e);else try{for(var i=b(s.sendDataChannels),a=i.next();!a.done;a=i.next()){var c=k(a.value,2);c[0];c[1].send(e)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},s.removePeer=function(e){s.peers.get(e).close(),vt("Remote Peer Connection Closed"),s.peers.delete(e),vt("Remote Peer Removed"),s.remoteStreams.delete(e),vt("Remote Peer Stream Removed")},s.close=function(){var e,t;try{for(var n=b(s.peers),r=n.next();!r.done;r=n.next()){var o=k(r.value,2),i=o[0];o[1];s.removePeer(i)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},s.secret=n,s.hasAudio=i||!0,s.hasVideo=o||!0,s.media={video:s.hasVideo,audio:s.hasAudio},s.streams=new MediaStream,s.startMedia(!0),s.name=btoa(Math.random().toString()).substring(10,5),s.poster=s.createPoster(s.name),s.room=r,s.buffer=50,s.remoteStreams=new Map,s.sendDataChannels=new Map,s.recieveDataChannels=new Map,s.peers=new Map,s.iceServers=[],s.id=btoa(Math.random().toString()).substring(16,4).split("").map((function(e){return"-_0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[~~(64*Math.random())]})).join(""),s.socket=Ie("https://p2p.6buns.com",{transports:["websocket","polling"],auth:{key:s.secret}}),s.socket.on("connection",(function(e,t,n){dt("Socket Connected",{id:e,users:t,iceServers:n}),s.iceServers=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],k(n),!1),s.peers.size>0?s.sendMessage("update-socket-id",{room:s.room,data:{id:s.socket.id,name:s.name}}):s.join()})),s.socket.on("message",(function(e){var t=e.type,n=e.from,r=e.to,o=e.room,i=e.token;return s.handleMessage({type:t,from:n,to:r,room:o,token:i})})),s.socket.on("peer-disconnected",(function(e){dt("Socket Disconnected",e),s.removePeer(e)})),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.crypt=function(e){var t=JSON.stringify(e);return btoa(t)},t.prototype.decrypt=function(e){return JSON.parse(atob(e))},t}(Ze.exports.EventEmitter);return e.Bun=yt,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
