var Bun=function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return a(e)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=f(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},l.apply(this,arguments)}function h(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
var v=function(e,t){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},v(e,t)};function y(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function m(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function g(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}var k=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,w=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],C=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o,i,s=k.exec(e||""),a={},c=14;c--;)a[w[c]]=s[c]||"";return-1!=n&&-1!=r&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){var n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.substr(0,1)&&0!==t.length||r.splice(0,1);"/"==t.substr(t.length-1,1)&&r.splice(r.length-1,1);return r}(0,a.path),a.queryKey=(o=a.query,i={},o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(i[t]=n)})),i),a};var E={exports:{}};try{E.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){E.exports=!1}var _=E.exports,S="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function A(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||_))return new XMLHttpRequest}catch(e){}if(!t)try{return new(S[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function T(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var O=setTimeout,R=clearTimeout;function x(e,t){t.useNativeTimers?(e.setTimeoutFn=O.bind(S),e.clearTimeoutFn=R.bind(S)):(e.setTimeoutFn=setTimeout.bind(S),e.clearTimeoutFn=clearTimeout.bind(S))}var F=L;function L(e){if(e)return function(e){for(var t in L.prototype)e[t]=L.prototype[t];return e}(e)}L.prototype.on=L.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},L.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},L.prototype.off=L.prototype.removeListener=L.prototype.removeAllListeners=L.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},L.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t)}return this},L.prototype.emitReserved=L.prototype.emit,L.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},L.prototype.hasListeners=function(e){return!!this.listeners(e).length};var N=Object.create(null);N.open="0",N.close="1",N.ping="2",N.pong="3",N.message="4",N.upgrade="5",N.noop="6";var j=Object.create(null);Object.keys(N).forEach((function(e){j[N[e]]=e}));for(var B={type:"error",data:"parser error"},P="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),M="function"==typeof ArrayBuffer,D=function(e,t,n){var r,o=e.type,i=e.data;return P&&i instanceof Blob?t?n(i):I(i,n):M&&(i instanceof ArrayBuffer||(r=i,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer))?t?n(i):I(new Blob([i]),n):n(N[o]+(i||""))},I=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U="undefined"==typeof Uint8Array?[]:new Uint8Array(256),V=0;V<q.length;V++)U[q.charCodeAt(V)]=V;var K,z="function"==typeof ArrayBuffer,H=function(e,t){if("string"!=typeof e)return{type:"message",data:$(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:Y(e.substring(1),t)}:j[n]?e.length>1?{type:j[n],data:e.substring(1)}:{type:j[n]}:B},Y=function(e,t){if(z){var n=function(e){var t,n,r,o,i,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),f=new Uint8Array(u);for(t=0;t<a;t+=4)n=U[e.charCodeAt(t)],r=U[e.charCodeAt(t+1)],o=U[e.charCodeAt(t+2)],i=U[e.charCodeAt(t+3)],f[c++]=n<<2|r>>4,f[c++]=(15&r)<<4|o>>2,f[c++]=(3&o)<<6|63&i;return u}(e);return $(n,t)}return{base64:!0,data:e}},$=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},J=String.fromCharCode(30),W=function(e){o(s,e);var n=u(s);function s(e){var r;return t(this,s),(r=n.call(this)).writable=!1,x(a(r),e),r.opts=e,r.query=e.query,r.readyState="",r.socket=e.socket,r}return r(s,[{key:"onError",value:function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,l(i(s.prototype),"emit",this).call(this,"error",n),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,l(i(s.prototype),"emit",this).call(this,"open")}},{key:"onData",value:function(e){var t=H(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){l(i(s.prototype),"emit",this).call(this,"packet",e)}},{key:"onClose",value:function(){this.readyState="closed",l(i(s.prototype),"emit",this).call(this,"close")}}]),s}(F),X="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),G={},Z=0,Q=0;function ee(e){var t="";do{t=X[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function te(){var e=ee(+new Date);return e!==K?(Z=0,K=e):e+"."+ee(Z++)}for(;Q<64;Q++)G[X[Q]]=Q;te.encode=ee,te.decode=function(e){var t=0;for(Q=0;Q<e.length;Q++)t=64*t+G[e.charAt(Q)];return t};var ne=te,re={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},oe=function(e){o(i,e);var n=u(i);function i(){var e;return t(this,i),(e=n.apply(this,arguments)).polling=!1,e}return r(i,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var r=0;this.polling&&(r++,this.once("pollComplete",(function(){--r||n()}))),this.writable||(r++,this.once("drain",(function(){--r||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(J),r=[],o=0;o<n.length;o++){var i=H(n[o],t);if(r.push(i),"error"===i.type)break}return r})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,r=new Array(n),o=0;e.forEach((function(e,i){D(e,!1,(function(e){r[i]=e,++o===n&&t(r.join(J))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emit("drain")}))}))}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=ne()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);var r=re.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}}]),i}(W);function ie(){}var se=null!=new A({xdomain:!1}).responseType,ae=function(e){o(i,e);var n=u(i);function i(e){var r;if(t(this,i),r=n.call(this,e),"undefined"!=typeof location){var o="https:"===location.protocol,s=location.port;s||(s=o?"443":"80"),r.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,r.xs=e.secure!==o}var a=e&&e.forceBase64;return r.supportsBinary=se&&!a,r}return r(i,[{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new ce(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(function(e){n.onError("xhr post error",e)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t}}]),i}(oe),ce=function(e){o(i,e);var n=u(i);function i(e,r){var o;return t(this,i),x(a(o=n.call(this)),r),o.opts=r,o.method=r.method||"GET",o.uri=e,o.async=!1!==r.async,o.data=void 0!==r.data?r.data:null,o.create(),o}return r(i,[{key:"create",value:function(){var e=this,t=T(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;var n=this.xhr=new A(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var r in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}catch(e){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?e.onLoad():e.setTimeoutFn((function(){e.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(t){return void this.setTimeoutFn((function(){e.onError(t)}),0)}"undefined"!=typeof document&&(this.index=i.requestsCount++,i.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=ie,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete i.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"abort",value:function(){this.cleanup()}}]),i}(F);if(ce.requestsCount=0,ce.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",ue);else if("function"==typeof addEventListener){addEventListener("onpagehide"in S?"pagehide":"unload",ue,!1)}function ue(){for(var e in ce.requests)ce.requests.hasOwnProperty(e)&&ce.requests[e].abort()}var fe="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},le=S.WebSocket||S.MozWebSocket,he="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),pe=function(e){o(i,e);var n=u(i);function i(e){var r;return t(this,i),(r=n.call(this,e)).supportsBinary=!e.forceBase64,r}return r(i,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=he?{}:T(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=he?new le(e,t,n):t?new le(e,t):new le(e)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(n){var r=e[n],o=n===e.length-1;D(r,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(e){}o&&fe((function(){t.writable=!0,t.emit("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n(r)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=ne()),this.supportsBinary||(e.b64=1);var r=re.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}},{key:"check",value:function(){return!(!le||"__initialize"in le&&this.name===i.prototype.name)}}]),i}(W),de={websocket:pe,polling:ae},ve=function(n){o(s,n);var i=u(s);function s(n){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,s),r=i.call(this),n&&"object"===e(n)&&(o=n,n=null),n?(n=C(n),o.hostname=n.host,o.secure="https"===n.protocol||"wss"===n.protocol,o.port=n.port,n.query&&(o.query=n.query)):o.host&&(o.hostname=C(o.host).host),x(a(r),o),r.secure=null!=o.secure?o.secure:"undefined"!=typeof location&&"https:"===location.protocol,o.hostname&&!o.port&&(o.port=r.secure?"443":"80"),r.hostname=o.hostname||("undefined"!=typeof location?location.hostname:"localhost"),r.port=o.port||("undefined"!=typeof location&&location.port?location.port:r.secure?"443":"80"),r.transports=o.transports||["polling","websocket"],r.readyState="",r.writeBuffer=[],r.prevBufferLen=0,r.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},o),r.opts.path=r.opts.path.replace(/\/$/,"")+"/","string"==typeof r.opts.query&&(r.opts.query=re.decode(r.opts.query)),r.id=null,r.upgrades=null,r.pingInterval=null,r.pingTimeout=null,r.pingTimeoutTimer=null,"function"==typeof addEventListener&&(r.opts.closeOnBeforeunload&&addEventListener("beforeunload",(function(){r.transport&&(r.transport.removeAllListeners(),r.transport.close())}),!1),"localhost"!==r.hostname&&(r.offlineEventListener=function(){r.onClose("transport close")},addEventListener("offline",r.offlineEventListener,!1))),r.open(),r}return r(s,[{key:"createTransport",value:function(e){var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new de[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&s.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(){t.onClose("transport close")}))}},{key:"probe",value:function(e){var t=this,n=this.createTransport(e),r=!1;s.priorWebsocketSuccess=!1;var o=function(){r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(function(e){if(!r)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",n),!n)return;s.priorWebsocketSuccess="websocket"===n.name,t.transport.pause((function(){r||"closed"!==t.readyState&&(l(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=n.name,t.emitReserved("upgradeError",o)}})))};function i(){r||(r=!0,l(),n.close(),n=null)}var a=function(e){var r=new Error("probe error: "+e);r.transport=n.name,i(),t.emitReserved("upgradeError",r)};function c(){a("transport closed")}function u(){a("socket closed")}function f(e){n&&e.name!==n.name&&i()}var l=function(){n.removeListener("open",o),n.removeListener("error",a),n.removeListener("close",c),t.off("close",u),t.off("upgrading",f)};n.once("open",o),n.once("error",a),n.once("close",c),this.once("close",u),this.once("upgrading",f),n.open()}},{key:"onOpen",value:function(){if(this.readyState="open",s.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},r=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?r():t()})):this.upgrading?r():t()),this}},{key:"onError",value:function(e){s.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),s}(F);ve.protocol=4;var ye="function"==typeof ArrayBuffer,me=Object.prototype.toString,ge="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===me.call(Blob),be="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===me.call(File);function ke(e){return ye&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))||ge&&e instanceof Blob||be&&e instanceof File}function we(t,n){if(!t||"object"!==e(t))return!1;if(Array.isArray(t)){for(var r=0,o=t.length;r<o;r++)if(we(t[r]))return!0;return!1}if(ke(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return we(t.toJSON(),!0);for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&we(t[i]))return!0;return!1}function Ce(e){var t=[],n=e.data,r=e;return r.data=Ee(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Ee(t,n){if(!t)return t;if(ke(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(Array.isArray(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=Ee(t[i],n);return o}if("object"===e(t)&&!(t instanceof Date)){var s={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(s[a]=Ee(t[a],n));return s}return t}function _e(e,t){return e.data=Se(e.data,t),e.attachments=void 0,e}function Se(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]=Se(t[r],n);else if("object"===e(t))for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(t[o]=Se(t[o],n));return t}var Ae;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Ae||(Ae={}));var Te=function(){function e(){t(this,e)}return r(e,[{key:"encode",value:function(e){return e.type!==Ae.EVENT&&e.type!==Ae.ACK||!we(e)?[this.encodeAsString(e)]:(e.type=e.type===Ae.EVENT?Ae.BINARY_EVENT:Ae.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==Ae.BINARY_EVENT&&e.type!==Ae.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),t}},{key:"encodeAsBinary",value:function(e){var t=Ce(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}]),e}(),Oe=function(n){o(a,n);var s=u(a);function a(){return t(this,a),s.call(this)}return r(a,[{key:"add",value:function(e){var t;if("string"==typeof e)(t=this.decodeString(e)).type===Ae.BINARY_EVENT||t.type===Ae.BINARY_ACK?(this.reconstructor=new Re(t),0===t.attachments&&l(i(a.prototype),"emitReserved",this).call(this,"decoded",t)):l(i(a.prototype),"emitReserved",this).call(this,"decoded",t);else{if(!ke(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,l(i(a.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===Ae[n.type])throw new Error("unknown packet type "+n.type);if(n.type===Ae.BINARY_EVENT||n.type===Ae.BINARY_ACK){for(var r=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(r,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var i=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(i,t)}else n.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var c=t+1;++t;){var u=e.charAt(t);if(null==u||Number(u)!=u){--t;break}if(t===e.length)break}n.id=Number(e.substring(c,t+1))}if(e.charAt(++t)){var f=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!a.isPayloadValid(n.type,f))throw new Error("invalid payload");n.data=f}return n}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(t,n){switch(t){case Ae.CONNECT:return"object"===e(n);case Ae.DISCONNECT:return void 0===n;case Ae.CONNECT_ERROR:return"string"==typeof n||"object"===e(n);case Ae.EVENT:case Ae.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case Ae.ACK:case Ae.BINARY_ACK:return Array.isArray(n)}}}]),a}(F);var Re=function(){function e(n){t(this,e),this.packet=n,this.buffers=[],this.reconPack=n}return r(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=_e(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),xe=Object.freeze({__proto__:null,protocol:5,get PacketType(){return Ae},Encoder:Te,Decoder:Oe});function Fe(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var Le=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Ne=function(e){o(s,e);var n=u(s);function s(e,r,o){var i;return t(this,s),(i=n.call(this)).connected=!1,i.disconnected=!0,i.receiveBuffer=[],i.sendBuffer=[],i.ids=0,i.acks={},i.flags={},i.io=e,i.nsp=r,o&&o.auth&&(i.auth=o.auth),i.io._autoConnect&&i.open(),i}return r(s,[{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[Fe(e,"open",this.onopen.bind(this)),Fe(e,"packet",this.onpacket.bind(this)),Fe(e,"error",this.onerror.bind(this)),Fe(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Le.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.unshift(e);var o={type:Ae.EVENT,data:n,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var i=this.ids++,s=n.pop();this._registerAckCallback(i,s),o.id=i}var a=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,c=this.flags.volatile&&(!a||!this.connected);return c||(this.connected?this.packet(o):this.sendBuffer.push(o)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n=this,r=this.flags.timeout;if(void 0!==r){var o=this.io.setTimeoutFn((function(){delete n.acks[e];for(var r=0;r<n.sendBuffer.length;r++)n.sendBuffer[r].id===e&&n.sendBuffer.splice(r,1);t.call(n,new Error("operation has timed out"))}),r);this.acks[e]=function(){n.io.clearTimeoutFn(o);for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];t.apply(n,[null].concat(r))}}else this.acks[e]=t}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e.packet({type:Ae.CONNECT,data:t})})):this.packet({type:Ae.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case Ae.CONNECT:if(e.data&&e.data.sid){var t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ae.EVENT:case Ae.BINARY_EVENT:this.onevent(e);break;case Ae.ACK:case Ae.BINARY_ACK:this.onack(e);break;case Ae.DISCONNECT:this.ondisconnect();break;case Ae.CONNECT_ERROR:this.destroy();var n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}(this._anyListeners.slice());try{for(n.s();!(t=n.n()).done;){t.value.apply(this,e)}}catch(e){n.e(e)}finally{n.f()}}l(i(s.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];t.packet({type:Ae.ACK,id:e,data:o})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){return e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:Ae.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),s}(F),je=Be;function Be(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Be.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Be.prototype.reset=function(){this.attempts=0},Be.prototype.setMin=function(e){this.ms=e},Be.prototype.setMax=function(e){this.max=e},Be.prototype.setJitter=function(e){this.jitter=e};var Pe=function(n){o(s,n);var i=u(s);function s(n,r){var o,c;t(this,s),(o=i.call(this)).nsps={},o.subs=[],n&&"object"===e(n)&&(r=n,n=void 0),(r=r||{}).path=r.path||"/socket.io",o.opts=r,x(a(o),r),o.reconnection(!1!==r.reconnection),o.reconnectionAttempts(r.reconnectionAttempts||1/0),o.reconnectionDelay(r.reconnectionDelay||1e3),o.reconnectionDelayMax(r.reconnectionDelayMax||5e3),o.randomizationFactor(null!==(c=r.randomizationFactor)&&void 0!==c?c:.5),o.backoff=new je({min:o.reconnectionDelay(),max:o.reconnectionDelayMax(),jitter:o.randomizationFactor()}),o.timeout(null==r.timeout?2e4:r.timeout),o._readyState="closed",o.uri=n;var u=r.parser||xe;return o.encoder=new u.Encoder,o.decoder=new u.Decoder,o._autoConnect=!1!==r.autoConnect,o._autoConnect&&o.open(),o}return r(s,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new ve(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var o=Fe(n,"open",(function(){r.onopen(),e&&e()})),i=Fe(n,"error",(function(n){r.cleanup(),r._readyState="closed",t.emitReserved("error",n),e?e(n):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var s=this._timeout;0===s&&o();var a=this.setTimeoutFn((function(){o(),n.close(),n.emit("error",new Error("timeout"))}),s);this.opts.autoUnref&&a.unref(),this.subs.push((function(){clearTimeout(a)}))}return this.subs.push(o),this.subs.push(i),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(Fe(e,"ping",this.onping.bind(this)),Fe(e,"data",this.ondata.bind(this)),Fe(e,"error",this.onerror.bind(this)),Fe(e,"close",this.onclose.bind(this)),Fe(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){this.emitReserved("packet",e)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new Ne(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var r=n[t];if(this.nsps[r].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var r=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),s}(F),Me={};function De(t,n){"object"===e(t)&&(n=t,t=void 0);var r,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=C(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var o=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+t,r.href=r.protocol+"://"+o+(n&&n.port===r.port?"":":"+r.port),r}(t,(n=n||{}).path||"/socket.io"),i=o.source,s=o.id,a=o.path,c=Me[s]&&a in Me[s].nsps;return n.forceNew||n["force new connection"]||!1===n.multiplex||c?r=new Pe(i,n):(Me[s]||(Me[s]=new Pe(i,n)),r=Me[s]),o.query&&!n.query&&(n.query=o.queryKey),r.socket(o.path,n)}Object.assign(De,{Manager:Pe,Socket:Ne,io:De,connect:De});var Ie={exports:{}},qe=1e3,Ue=6e4,Ve=60*Ue,Ke=24*Ve,ze=7*Ke,He=365.25*Ke,Ye=function(t,n){n=n||{};var r=e(t);if("string"===r&&t.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*He;case"weeks":case"week":case"w":return n*ze;case"days":case"day":case"d":return n*Ke;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Ve;case"minutes":case"minute":case"mins":case"min":case"m":return n*Ue;case"seconds":case"second":case"secs":case"sec":case"s":return n*qe;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===r&&isFinite(t))return n.long?function(e){var t=Math.abs(e);if(t>=Ke)return $e(e,t,Ke,"day");if(t>=Ve)return $e(e,t,Ve,"hour");if(t>=Ue)return $e(e,t,Ue,"minute");if(t>=qe)return $e(e,t,qe,"second");return e+" ms"}(t):function(e){var t=Math.abs(e);if(t>=Ke)return Math.round(e/Ke)+"d";if(t>=Ve)return Math.round(e/Ve)+"h";if(t>=Ue)return Math.round(e/Ue)+"m";if(t>=qe)return Math.round(e/qe)+"s";return e+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function $e(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}var Je,We,Xe,Ge=function(e){function t(e){var r,o,i,s=null;function a(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(a.enabled){var i=a,s=Number(new Date),c=s-(r||s);i.diff=c,i.prev=r,i.curr=s,r=s,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var u=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return"%";u++;var o=t.formatters[r];if("function"==typeof o){var s=n[u];e=o.call(i,s),n.splice(u,1),u--}return e})),t.formatArgs.call(i,n);var f=i.log||t.log;f.apply(i,n)}}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i)},set:function(e){s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(h(t.names.map(r)),h(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Ye,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};Je=Ie,(We=Ie.exports).formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Je.exports.humanize(this.diff),this.useColors){var t="color: "+this.color;e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))})),e.splice(r,0,t)}},We.save=function(e){try{e?We.storage.setItem("debug",e):We.storage.removeItem("debug")}catch(e){}},We.load=function(){var e;try{e=We.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},We.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},We.storage=function(){try{return localStorage}catch(e){}}(),We.destroy=(Xe=!1,function(){Xe||(Xe=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),We.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],We.log=console.debug||console.log||function(){},Je.exports=Ge(We),Je.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};var Ze,Qe=Ie.exports,et={exports:{}},tt="object"===("undefined"==typeof Reflect?"undefined":e(Reflect))?Reflect:null,nt=tt&&"function"==typeof tt.apply?tt.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};Ze=tt&&"function"==typeof tt.ownKeys?tt.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var rt=Number.isNaN||function(e){return e!=e};function ot(){ot.init.call(this)}et.exports=ot,et.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}dt(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&dt(e,"error",t,n)}(e,o,{once:!0})}))},ot.EventEmitter=ot,ot.prototype._events=void 0,ot.prototype._eventsCount=0,ot.prototype._maxListeners=void 0;var it=10;function st(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+e(t))}function at(e){return void 0===e._maxListeners?ot.defaultMaxListeners:e._maxListeners}function ct(e,t,n,r){var o,i,s,a;if(st(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=at(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function ut(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ft(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=ut.bind(r);return o.listener=n,r.wrapFn=o,o}function lt(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):pt(o,o.length)}function ht(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function pt(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function dt(t,n,r,o){if("function"==typeof t.on)o.once?t.once(n,r):t.on(n,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+e(t));t.addEventListener(n,(function e(i){o.once&&t.removeEventListener(n,e),r(i)}))}}Object.defineProperty(ot,"defaultMaxListeners",{enumerable:!0,get:function(){return it},set:function(e){if("number"!=typeof e||e<0||rt(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");it=e}}),ot.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ot.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||rt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ot.prototype.getMaxListeners=function(){return at(this)},ot.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var s=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw s.context=i,s}var a=o[e];if(void 0===a)return!1;if("function"==typeof a)nt(a,this,t);else{var c=a.length,u=pt(a,c);for(n=0;n<c;++n)nt(u[n],this,t)}return!0},ot.prototype.addListener=function(e,t){return ct(this,e,t,!1)},ot.prototype.on=ot.prototype.addListener,ot.prototype.prependListener=function(e,t){return ct(this,e,t,!0)},ot.prototype.once=function(e,t){return st(t),this.on(e,ft(this,e,t)),this},ot.prototype.prependOnceListener=function(e,t){return st(t),this.prependListener(e,ft(this,e,t)),this},ot.prototype.removeListener=function(e,t){var n,r,o,i,s;if(st(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},ot.prototype.off=ot.prototype.removeListener,ot.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},ot.prototype.listeners=function(e){return lt(this,e,!0)},ot.prototype.rawListeners=function(e){return lt(this,e,!1)},ot.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):ht.call(e,t)},ot.prototype.listenerCount=ht,ot.prototype.eventNames=function(){return this._eventsCount>0?Ze(this._events):[]};var vt=Qe("Socket"),yt=Qe("Peer"),mt=Qe("Remote"),gt=function(e){function t(t){var n=t.apiKey,r=t.room,o=t.hasVideo,i=t.hasAudio,s=e.call(this)||this;return s.join=function(){return y(s,void 0,void 0,(function(){var e=this;return m(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){vt("Joining Room"),e.socket.emit("join-room",e.room,(function(n){var r=n.res,o=n.err;o?vt("Socket Error",o):r&&(vt("Room Joined",r),r.length>1&&(vt("Peers List Recieved"),r.forEach((function(t){t!==e.socket.id&&e.socket.emit("connection-request",{from:e.socket.id,to:t,data:{response:!0,peerName:e.name}})})),yt("Establishing Peer Connection to Remote Peer."),t()))}))}))];case 1:return t.sent(),[2]}}))}))},s.addMediaTrack=function(e,t){var n,r;if(s.streams.addTrack(e),t)s.peers.get(t).addTrack(e);else if(s.peers.size>0)try{for(var o=g(s.peers),i=o.next();!i.done;i=o.next()){var a=b(i.value,2);a[0];a[1].addTrack(e)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},s.addMedia=function(e,t){e.getTracks().forEach((function(e){return t?s.addMediaTrack(e,t):s.addMediaTrack(e)})),yt("Added new Stream",s.peers)},s.removeMediaTrack=function(e){var t,n,r=function(t,n){n.getSenders().forEach((function(t){var r;(null===(r=null==t?void 0:t.track)||void 0===r?void 0:r.kind)===e.kind&&(n.removeTrack(t),vt("Track Update Request Sent."),s.socket.emit("track-update",{id:n.from.name,update:"end",room:s.room}))}))};try{for(var o=g(s.peers),i=o.next();!i.done;i=o.next()){var a=b(i.value,2);a[0];r(0,a[1])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}s.streams.removeTrack(e)},s.removeMedia=function(e){e.getTracks().forEach((function(e){return s.removeMediaTrack(e)})),yt("Removed Stream",e)},s.startMedia=function(e){return y(s,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,this.getMedia()];case 1:return t=n.sent(),this.addStream(t),e?this.streams=t:(this.streams=t,this.replaceMedia(t)),[2]}}))}))},s.getMedia=function(){return new Promise((function(e,t){navigator.mediaDevices.getUserMedia({video:s.media.video,audio:s.media.audio}).then((function(t){yt(t),e(t)})).catch(t)}))},s.screenShare=function(){return navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){var t=e.getVideoTracks()[0];yt("Sharing Screen",t),t.onended=function(e){return y(s,void 0,void 0,(function(){return m(this,(function(t){return yt("Stop Sharing Screen"),this.emit("screen-share-ended",e),this.replaceMedia(this.streams),this.addStream(this.streams),[2]}))}))},s.replaceMedia(e),s.addStream(e)})).catch(console.error)},s.addStream=function(e){var t=document.querySelector(".self");t.srcObject=e,t.onloadedmetadata=function(e){t.play()}},s.toggleMedia=function(e,t){if(e)switch(e){case"video":s.streams.getVideoTracks().forEach((function(e){e.enabled=!e.enabled}));break;case"audio":s.streams.getAudioTracks().forEach((function(e){e.enabled=!e.enabled}));break;case"all":s.streams.getTracks().forEach((function(e){e.enabled=!e.enabled}))}t&&s.peers.get(t).getSenders().forEach((function(t){var n,r;e?(null===(n=null==t?void 0:t.track)||void 0===n?void 0:n.kind)===e&&t.track.stop():null===(r=null==t?void 0:t.track)||void 0===r||r.stop()}))},s.createPoster=function(e){var t=document.createElement("canvas");t.id="canv",t.height=600,t.width=800,document.body.appendChild(t);var n=document.getElementById("canv").getContext("2d");n.fillStyle="#1C1917",n.fillRect(0,0,800,600),n.fillStyle="#FAFAF9",n.textAlign="center",n.font="64px sans-serif",n.fillText(e,400,300);var r=t.toDataURL();return document.body.removeChild(t),r},s.getLocalMedia=function(e){return s.peers.get(e).getLocalStream()},s.getRemoteStream=function(e){return s.peers.get(e).getRemoteStream()},s.replaceMediaTrack=function(e,t){var n,r;if(t)s.peers.get(t).getSenders().forEach((function(t){var n;(null===(n=null==t?void 0:t.track)||void 0===n?void 0:n.kind)===e.kind&&(e.enabled=!0,t.replaceTrack(e))}));else try{for(var o=g(s.peers),i=o.next();!i.done;i=o.next()){var a=b(i.value,2);a[0];a[1].getSenders().forEach((function(t){var n;(null===(n=null==t?void 0:t.track)||void 0===n?void 0:n.kind)===e.kind&&t.replaceTrack(e)}))}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},s.replaceMedia=function(e,t){return new Promise((function(n,r){var o,i,a,c,u,f;try{if(t)try{for(var l=g(e.getTracks()),h=l.next();!h.done;h=l.next()){var p=h.value;t?s.replaceMediaTrack(p,t):s.replaceMediaTrack(p),yt("Replacing Track",p,t)}}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}else try{for(var d=g(s.peers),v=d.next();!v.done;v=d.next()){var y=b(v.value,2),m=y[0];if(y[1].getSenders().length>0)try{for(var k=(u=void 0,g(e.getTracks())),w=k.next();!w.done;w=k.next()){p=w.value;s.replaceMediaTrack(p,m),yt("Replacing Track",p,m)}}catch(e){u={error:e}}finally{try{w&&!w.done&&(f=k.return)&&f.call(k)}finally{if(u)throw u.error}}}}catch(e){a={error:e}}finally{try{v&&!v.done&&(c=d.return)&&c.call(d)}finally{if(a)throw a.error}}n(!0)}catch(e){r(e)}}))},s.removePeer=function(e){s.peers.get(e).close(),s.peers.delete(e)},s.close=function(){var e,t;try{for(var n=g(s.peers),r=n.next();!r.done;r=n.next()){var o=b(r.value,2),i=o[0];o[1];s.removePeer(i)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},s.apiKey=n,s.hasAudio=i||!0,s.hasVideo=o||!0,s.media={video:s.hasVideo,audio:s.hasAudio},s.streams=new MediaStream,s.startMedia(!0),s.name=btoa(Math.random().toString()).substring(10,5),s.poster=s.createPoster(s.name),s.room=r,s.buffer=50,s.remoteStreams=new Map,s.peers=new Map,s.iceServers=[],s.id=btoa(Math.random().toString()).substring(16,4).split("").map((function(e){return"-_0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[~~(64*Math.random())]})).join(""),s.socket=De("https://p2p.6buns.com",{transports:["websocket","polling"],auth:{key:s.apiKey}}),s.socket.on("connection",(function(e,t,n){vt("Socket Connected",{id:e,users:t,iceServers:n}),s.iceServers=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],b(n),!1),s.join()})),s.socket.on("peer-connection-request",(function(e){var t=e.from,n=e.to,r=e.data,o=r.response,i=r.peerName;o&&s.socket.emit("connection-request",{from:n,to:t,data:{response:!1,peerName:s.name}}),vt("New Peer Connected. Waiting for an offer"),s.peers.set(i,new RTCPeerConnection({iceServers:s.iceServers}));var a=s.peers.get(i);mt("Adding Tracks",s.streams),s.streams.getTracks().forEach((function(e){a.addTrack(e,s.streams)})),mt("Tracks Added"),a.ontrack=function(e){var t=e.currentTarget.to;s.remoteStreams.set(t.name,e.streams),s.emit("new-remote-track",e)},a.onicecandidate=function(e){if(e.candidate){mt("ICE Candidate",e);var t=e.currentTarget;s.socket.emit("data",{from:t.from.socket,to:t.to.socket,data:{name:a.from.name,candidate:e.candidate}})}},a.onnegotiationneeded=function(e){return y(s,void 0,void 0,(function(){var t,n,r;return m(this,(function(o){switch(o.label){case 0:t=e.currentTarget,o.label=1;case 1:return o.trys.push([1,4,5,6]),t.makingOffer=!0,mt("Negotiation needed",e),[4,t.createOffer()];case 2:return n=o.sent(),mt("Offer Generated",n),"stable"!=t.signalingState?[2]:[4,t.setLocalDescription(n)];case 3:return o.sent(),mt("Local Description Set",t.localDescription),t.socket.emit("data",{to:t.to.socket,from:t.from.socket,data:{name:t.from.name,sdp:t.localDescription}}),[3,6];case 4:return r=o.sent(),console.error(new Error(r)),[3,6];case 5:return t.makingOffer=!1,[7];case 6:return[2]}}))}))},a.onconnectionstatechange=function(e){switch(a.connectionState){case"new":case"connecting":mt("Connecting...");break;case"connected":mt("Connected."),s.emit("new-peer",a),a.checkConnection();break;case"disconnected":mt("Disconnecting..."),a.checkConnection();break;case"closed":mt("Offline");break;case"failed":mt("Error"),a.checkConnection()}},a.checkConnection=function(){var e=a.connectionState,t=a.iceConnectionState,n=a.iceGatheringState,r=a.signalingState;"connected"===e&&"connected"===t&&"complete"===n&&"stable"===r?mt("Connection Established."):"disconnected"!==e&&"closed"!==e&&"failed"!==e||"disconnected"!==t&&"failed"!==t&&"closed"!==t||(mt("Error in Connection Establishment"),s.emit("peer-left",a.to.name),a.close(),mt("Remote Peer Connection Closed"),s.peers.delete(a.to.name),mt("Remote Peer Removed"))},a.from={name:s.name,socket:s.socket.id},a.to={name:i,socket:t},a.initiator=o,a.ignoreOffer=!1,a.makingOffer=!1,a.socket=s.socket,a.poster=s.createPoster(i)})),s.socket.on("data",(function(e){var t=e.to,n=e.from,r=e.data,o=r.name,i=r.sdp,a=r.candidate;return y(s,void 0,void 0,(function(){var e,r,s,c,u;return m(this,(function(f){switch(f.label){case 0:if(!this.peers.has(o)||t!==this.socket.id)return[3,15];f.label=1;case 1:return f.trys.push([1,14,,15]),e=this.peers.get(o),yt("Data recieved",{name:o,sdp:i,candidate:a}),i?(r="offer"===i.type&&(e.makingOffer||"stable"!==e.signalingState),e.ignoreOffer=!e.initiator&&r,e.ignoreOffer?[2]:r?[4,Promise.all([e.setLocalDescription({type:"rollback"}),e.setRemoteDescription(i)])]:[3,3]):[3,9];case 2:return f.sent(),[3,5];case 3:return yt("Answer Recieved",i),[4,e.setRemoteDescription(i)];case 4:f.sent(),f.label=5;case 5:return"offer"!==i.type?[3,8]:[4,e.createAnswer()];case 6:return s=f.sent(),yt("Answer Created",s),[4,e.setLocalDescription(s)];case 7:f.sent(),yt("Local description set as answer",e.localDescription),this.socket.emit("data",{to:n,from:t,data:{name:this.name,sdp:e.localDescription}}),f.label=8;case 8:return[3,13];case 9:if(!a)return[3,13];f.label=10;case 10:return f.trys.push([10,12,,13]),[4,e.addIceCandidate(a)];case 11:return f.sent(),yt("Added Ice Candidate",a),[3,13];case 12:return c=f.sent(),e.ignoreOffer?yt("Should be ignored",c,a,this.peers.has(o),t===this.socket.id):yt("Error adding IceCandidate",c),[3,13];case 13:return[3,15];case 14:return u=f.sent(),vt("Socket Error",u),[3,15];case 15:return[2]}}))}))})),s.socket.on("track-update",(function(e){var t=e.id,n=e.update;switch(vt("Track Update Recieved",t,n),n){case"mute":s.emit("remote-peer-track-muted",t);break;case"unmute":s.emit("remote-peer-track-unmuted",t);break;case"end":s.remoteStreams.get(t).forEach((function(e){return e.getVideoTracks()[0].stop()})),s.emit("remote-peer-track-ended",t)}})),s.socket.on("peer-disconneted",(function(e){var t=s.peers.get(e);vt("Socket Disconnected",t),s.emit("peer-left",t.to),t.close(),mt("Remote Peer Connection Closed"),s.peers.delete(e),mt("Remote Peer Removed")})),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(et.exports.EventEmitter);return gt}();
